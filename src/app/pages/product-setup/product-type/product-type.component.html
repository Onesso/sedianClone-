<!-- Start Breadcrumbs -->
<app-breadcrumbs title="Product Types" [breadcrumbItems]="breadCrumbItems"></app-breadcrumbs>
<!-- End Breadcrumbs -->
<div class="row">
    <div class="col-lg-12">
        <div class="card" id="applicationList">
            <div class="card-header  border border-dashed border-end-0 border-start-0">
                <div class="d-md-flex justify-content-between align-items-center">
                    <div class="search-box">
                        <input type="text" class="form-control search"
                            placeholder="Search..."
                            [(ngModel)]="service.searchTerm">
                        <i class="ri-search-line search-icon"></i>
                    </div>
                    <div class="flex-shrink-0">
                        <div class="d-flex gap-1 flex-wrap">
                            <button type="button" class="btn btn-warning add-btn" data-bs-toggle="modal" id="create-btn"
                                data-bs-target="#showModal" (click)="openModel(content)"><i
                                    class="ri-add-line align-bottom me-1"></i> Add Product Type</button>                                                   
                        </div>
                    </div>
                </div>
            </div>
   
            <div class="card-body pt-0">
                <div>                 
                    <table class="table table-nowrap align-middle">
                        <thead class="text-muted table-light">
                          
                            <tr class="text-uppercase"> 
                                <th appsortable="name">Account Type
                                </th>                                                             
                                <th appsortable="id"
                                    style="width: 140px;">Bundle Code</th>
                                <th appsortable="name">Name
                                </th>
                                <th appsortable="designation">
                                    Category</th> 
                                <th appsortable="designation">
                                    Type</th> 
                                <th appsortable="designation">
                                    Score</th>          
                                                     
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody class="list form-check-all">
                            <tr *ngFor="let data of this.approved;let i = index">                             
                                <td class="id"><a href="javascript:void(0);"
                                        class="fw-medium link-primary">{{data.accountType}}</a>
                                </td>
                                <td class="designation">{{data.bundleCode? data.bundleCode:"-"}}</td>
                                <td class="designation">{{data.name}}</td>
                                <td class="designation">{{data.accountTag}}</td>
                               
                                <td class="date">{{data.onboardingType == '1' ? 'SELF': 'AGENT'}}</td>     
                                <td class="date">{{data.score}}</td>                   
                                <td>
                                    <ul class="list-inline hstack gap-2 mb-0">
                                        <li class="list-inline-item" data-bs-toggle="tooltip"
                                        data-bs-trigger="hover" data-bs-placement="top"
                                        (click)="viewMapping(data.id)"
                                        ngbTooltip="View Mapping">
                                        <button class="btn btn-sm view-btn edit-item-btn"                                            
                                            ><i class="ri-eye-fill fs-16"></i></button>                                   
                                        </li>
                                  
                                        <li class="list-inline-item me-0" data-bs-toggle="tooltip"
                                            data-bs-trigger="hover" data-bs-placement="top"
                                            ngbTooltip="Edit">                                      
                                            <button class="btn btn-sm remind-btn edit-item-btn" 
                                            (click)="openEditModal(editcontent,data)"
                                            data-bs-toggle="modal" data-bs-target="#showModal"
                                            ><i class="ri-pencil-fill fs-16"></i>                                       
                                            </button>
                                        </li>
                                        <li class="list-inline-item edit" data-bs-toggle="tooltip"
                                        data-bs-trigger="hover" data-bs-placement="top"
                                        ngbTooltip="Set Product Bundle Income Range">
                                        <button class="btn btn-sm validate-btn edit-item-btn"
                                        data-bs-toggle="modal" data-bs-target="#showModal"
                                        (click)="openMappingModal(mappingcontent,data)"
                                        >
                                        <i class="ri-settings-5-fill fs-16"></i>                                                                       
                                        </button>
                                        </li>
                                        <li class="list-inline-item me-0" data-bs-toggle="tooltip"
                                        data-bs-trigger="hover" data-bs-placement="top"
                                        ngbTooltip="Remove">
                                            <button class="btn btn-sm delete-btn edit-item-btn"
                                            data-bs-toggle="modal"
                                            (click)="confirm(deletemodal,data.id)">
                                            <i class="ri-delete-bin-5-fill fs-16"></i></button>
                                        </li>                                     
                                    </ul>
                                </td>
                            </tr>
                        </tbody>
                    </table>
      

                <!-- Tab Pane -->
                <div class="table-responsive table-card mb-1">
                    <div class="noresult" style="display: none">
                        <div class="text-center">
                            <lord-icon src="https://cdn.lordicon.com/msoeawqm.json" trigger="loop"
                                colors="primary:#405189,secondary:#0ab39c" style="width:75px;height:75px">
                            </lord-icon>
                            <h5 class="mt-2">Sorry! No Result Found</h5>
                            <p class="text-muted">We've searched more than 150+ result We did not find jobs for you
                                search.</p>
                        </div>
                    </div>                      
                </div>
                <div class="row justify-content-md-between align-items-md-center">
                    <div class="col col-sm-6">
                        <div class="dataTables_info mb-2" id="tickets-table_info" role="status" aria-live="polite">
                            Showing
                            {{this.startIndex}} to
                            {{this.endIndex}} of {{this.totalRecords}}
                            entries
                        </div>
                    </div>
                    <!-- Pagination -->
                    <div class="col col-sm-6">
                        <div class="text-sm-right float-sm-end listjs-pagination">
                            <ngb-pagination [collectionSize]="this.totalRecords" [(page)]="this.currentPage"
                                [pageSize]="this.pageSize" (pageChange)="onPageChange($event)">
                            </ngb-pagination>
                        </div>
                    </div>
                    <!-- End Pagination -->
                </div>

                <div id="elmLoader">
                    <div class="spinner-border text-primary avatar-sm" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
                </div>


                <!-- Modal -->
                <ng-template #content role="document" let-modal>
                    <div class="modal-header bg-light p-3">
                        <h5 class="modal-title" id="exampleModalLabel">New Product Type&nbsp;</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                            (click)="modal.dismiss('close click')" id="close-modal"></button>
                    </div>
                    <form autocomplete="off" (ngSubmit)="createProductType()" [formGroup]="applicationData">
                        <div class="modal-body">          
                            <div class="row">
                                <div class="col-6">
                                    <label for="designation-field" class="form-label">Account Type</label>
                                    <select class="form-select mb-3" formControlName="accountType" aria-label="Default select">
                                        <option selected>Select</option>
                                        <option *ngFor="let account of accountTypes" value="{{ account.accountCode }}"> {{ account.name }}</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label for="designation-field" class="form-label">Account Category</label>
                                    <select class="form-select mb-3" formControlName="category"  aria-label="Default select example">
                                        <option selected>Select </option>
                                        <option *ngFor="let account of parentAccounts" value="{{ account.id }}">{{ account.shortDescription }}</option>
                                      
                                    </select>
                                </div>

                            </div>     
                            <div class="row">
                                <div class="mb-3 col-6">
                                    <label for="company-field" class="form-label">Bundle Code</label>
                                    <input type="text" id="company-field" class="form-control" formControlName="bundleCode"
                                        placeholder="" required />
                                </div>
                                <div class="col-6">
                                    <label for="designation-field" class="form-label">Onboarding Type</label>
                                    <select class="form-select mb-3" formControlName="onboardingType" aria-label="Default select example">
                                        <option selected>Select</option>
                                        <option value="1">SELF</option>                                     
                                    </select>
                                </div>

                            </div>        
                
                          <div class="row">
                            <div class="mb-3 col-6">
                                <label for="designation-field" class="form-label">Name</label>
                                <input type="text" id="designation-field" class="form-control"
                                formControlName="name" placeholder="Account name" required />
                            </div>
                            <div class="mb-3 col-6">
                                <label for="company-field" class="form-label">Product Rating</label>
                                <input type="text" id="company-field" class="form-control" formControlName="score"
                                    placeholder="" required />
                            </div>

                          </div>

                          <div class="row">
                            <div class="mb-3 col-6">
                                <label for="designation-field" class="form-label">Opening Balance</label>
                                <input type="text" id="designation-field" class="form-control"
                                formControlName="openningBalance" placeholder="" required />
                            </div>
                            <div class="mb-3 col-6">
                                <label for="company-field" class="form-label">Monthly Fee</label>
                                <input type="text" id="company-field" class="form-control" formControlName="monthlyFee"
                                    placeholder="" required />
                            </div>
                          </div>

                          <div class="row">
                            <div class="mb-3 col-6">
                                <label for="designation-field" class="form-label">Joint Account Allowed?</label>
                                <select class="form-select mb-3"  formControlName="multipleAccountYN" aria-label="Default select example">
                                    <option selected>Select</option>
                                    <option value="Y">Yes</option>
                                    <option value="N">No</option>                                    
                                </select>
                            </div>
                            <div class="mb-3 col-6">
                                <label for="company-field" class="form-label">Savings Account Allowed?</label>
                                <select formControlName="savingYn"  class="form-select mb-3" aria-label="Default select example">
                                    <option selected>Select</option>
                                    <option value="N">Yes</option>
                                    <option value="Y">No</option>
                                   
                                </select>
                            </div>

                          </div>
                          

                            <div class="mb-3">
                                <label for="designation-field" class="form-label">Target market</label>
                                <ckeditor formControlName="targetMarket" [editor]="Editor" data="" class="ck-editor__editable_inline" ></ckeditor>
                            </div>

                            <div class="mb-3">
                                <label for="designation-field" class="form-label">Benefits</label>
                                <ckeditor formControlName="benefits"  [editor]="Editor" data="" class="ck-editor__editable_inline" ></ckeditor>
                            </div>

                         
                          <div class="mb-3">
                            <label for="designation-field" class="form-label">Features</label>
                            <ckeditor  formControlName="features" [editor]="Editor" data="" class="ck-editor__editable_inline" ></ckeditor>
                          </div>
                          
                          <hr>
                            

                                
                        <div class="mb-3">
                            <label for="designation-field" class="form-label">Account Product Title</label>
                            <input type="text" id="designation-field" class="form-control"
                            formControlName="policyTitle"  placeholder="" required />
                        </div>
                          

                        <div class="mb-3">
                            <label for="contact-field" class="form-label">Account Product Description</label>
                            <ckeditor formControlName="policyDescription"  [editor]="Editor" data="" class="ck-editor__editable_inline" ></ckeditor>                            
                        </div>
                        <div class="mb-3">
                            <label for="contact-field" class="form-label">Policy Image</label>
                             <ngx-dropzone (change)="onSelect($event)">
                                <ngx-dropzone-label>Click or drag files to upload</ngx-dropzone-label>
                                <ngx-dropzone-preview *ngFor="let f of files" [removable]="true" (removed)="onRemove(f)">
                                    <ngx-dropzone-label>{{ f.name }} ({{ f.type }})</ngx-dropzone-label>
                                </ngx-dropzone-preview>
                            </ngx-dropzone>
                        </div>                  
                        </div>
                        <div class="mt-4">
                            <div class="hstack d-flex gap-2 justify-content-between mx-4 mb-4">
                                <div>
                                    <!-- "Close" button -->
                                    <button type="button" class="btn btn-light btn-lg w-100" data-bs-dismiss="modal" (click)="modal.dismiss('close click')">Close</button>
                                </div>
                                <div>
                                    <!-- "Add" button -->
                                    <button [disabled]="loading" type="submit" class="btn btn-primary btn-lg px-4 w-100" id="add-btn">Add Product<span class="spinner-border spinner-border-sm ml-2" role="status" aria-hidden="true" *ngIf="loading"></span></button>
                                </div>
                            </div>

                        </div>
                    </form>
                </ng-template>



                <!--Edit Modal -->
                <ng-template #editcontent role="document" let-modal>
                    <div class="modal-header bg-light p-3">
                        <h5 class="modal-title" id="exampleModalLabel">Edit Product Type&nbsp;</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                            (click)="modal.dismiss('close click')" id="close-modal"></button>
                    </div>
                    <form autocomplete="off" (ngSubmit)="updateProductType()" [formGroup]="editForm">
                        <div class="modal-body">          
                            <div class="row">
                                <div class="col-6">
                                    <label for="designation-field" class="form-label">Account Type</label>
                                    <select class="form-select mb-3" formControlName="accountType" aria-label="Default select">
                                        <option selected>Select</option>
                                        <option *ngFor="let account of accountTypes" value="{{ account.accountCode }}"> {{ account.name }}</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label for="designation-field" class="form-label">Account Category</label>
                                    <select class="form-select mb-3" formControlName="category"  aria-label="Default select example">
                                        <option selected>Select </option>
                                        <option *ngFor="let account of parentAccounts" value="{{ account.id }}">{{ account.shortDescription }}</option>
                                      
                                    </select>
                                </div>

                            </div>     
                            <div class="row">
                                <div class="mb-3 col-6">
                                    <label for="company-field" class="form-label">Bundle Code</label>
                                    <input type="text" id="company-field" class="form-control" formControlName="bundleCode"
                                        placeholder="" required />
                                </div>
                                <div class="col-6">
                                    <label for="designation-field" class="form-label">Onboarding Type</label>
                                    <select class="form-select mb-3" formControlName="onboardingType" aria-label="Default select example">
                                        <option selected>Select</option>
                                        <option value="1">SELF</option>
                                        <!-- <option value="AGENT">AGENT</option> -->
               
                                    </select>
                                </div>

                            </div>        
                
                          <div class="row">
                            <div class="mb-3 col-6">
                                <label for="designation-field" class="form-label">Name</label>
                                <input type="text" id="designation-field" class="form-control"
                                formControlName="name" placeholder="Account name" required />
                            </div>
                            <div class="mb-3 col-6">
                                <label for="company-field" class="form-label">Product Rating</label>
                                <input type="text" id="company-field" class="form-control" formControlName="score"
                                    placeholder="" required />
                            </div>

                          </div>

                          <div class="row">
                            <div class="mb-3 col-6">
                                <label for="designation-field" class="form-label">Opening Balance</label>
                                <input type="text" id="designation-field" class="form-control"
                                formControlName="openningBalance" placeholder="" required />
                            </div>
                            <div class="mb-3 col-6">
                                <label for="company-field" class="form-label">Monthly Fee</label>
                                <input type="text" id="company-field" class="form-control" formControlName="monthlyFee"
                                    placeholder="" required />
                            </div>

                          </div>

                          <div class="row">
                            <div class="mb-3 col-6">
                                <label for="designation-field" class="form-label">Joint Account Allowed?</label>
                                <select class="form-select mb-3"  formControlName="multipleAccountYN" aria-label="Default select example">
                                    <option selected>Select</option>
                                    <option value="Y">Yes</option>
                                    <option value="N">No</option>                                    
                                </select>
                            </div>
                            <div class="mb-3 col-6">
                                <label for="company-field" class="form-label">Savings Account Allowed?</label>
                                <select formControlName="savingYn"  class="form-select mb-3" aria-label="Default select example">
                                    <option selected>Select</option>
                                    <option value="N">Yes</option>
                                    <option value="Y">No</option>
                                   
                                </select>
                            </div>

                          </div>
                          

                            <div class="mb-3">
                                <label for="designation-field" class="form-label">Target market</label>
                                <ckeditor formControlName="targetMarket" [editor]="Editor" data="" class="ck-editor__editable_inline" ></ckeditor>
                            </div>

                            <div class="mb-3">
                                <label for="designation-field" class="form-label">Benefits</label>
                                <ckeditor formControlName="benefits"  [editor]="Editor" data="" class="ck-editor__editable_inline" ></ckeditor>
                            </div>

                         
                          <div class="mb-3">
                            <label for="designation-field" class="form-label">Features</label>
                            <ckeditor  formControlName="features" [editor]="Editor" data="" class="ck-editor__editable_inline" ></ckeditor>
                          </div>
                          
                          <hr>
                            

                                
                        <div class="mb-3">
                            <label for="designation-field" class="form-label">Account Product Title</label>
                            <input type="text" id="designation-field" class="form-control"
                            formControlName="policyTitle"  placeholder="" required />
                        </div>
                          

                        <div class="mb-3">
                            <label for="contact-field" class="form-label">Account Product Description</label>
                            <ckeditor formControlName="policyDescription"  [editor]="Editor" data="" class="ck-editor__editable_inline" ></ckeditor>                            
                        </div>
                        
                        <div class="mb-3">
                            <label for="contact-field" class="form-label">Account Product Image</label>
                            <ngx-dropzone (change)="onSelect($event)">
                                <ngx-dropzone-label>Click or drag files to upload</ngx-dropzone-label>
                                <ngx-dropzone-preview *ngFor="let f of files" [removable]="true" (removed)="onRemove(f)">
                                    <ngx-dropzone-label>{{ f.name }} ({{ f.type }})</ngx-dropzone-label>
                                </ngx-dropzone-preview>
                            </ngx-dropzone>
                        </div>                  
                        </div>
                        <div class="mt-4">
                            <div class="hstack d-flex gap-2 justify-content-between mx-4 mb-4">
                                <div>
                                    <!-- "Close" button -->
                                    <button type="button" class="btn btn-light btn-lg w-100" data-bs-dismiss="modal" (click)="modal.dismiss('close click')">Close</button>
                                </div>
                                <div>
                                    <!-- "Add" button -->
                                    <button [disabled]="loading" type="submit" class="btn btn-primary btn-lg px-4 w-100" id="add-btn">Update Product<span class="spinner-border spinner-border-sm ml-2" role="status" aria-hidden="true" *ngIf="loading"></span></button>
                                </div>
                            </div>

                        </div>
                    </form>
                </ng-template>

                <!--Set Mapping Modal-->
                <ng-template #mappingcontent role="document" let-modal>
                    <div class="modal-header bg-light p-3">
                        <h5 class="modal-title" id="exampleModalLabel">Set Account Mapping</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                            (click)="modal.dismiss('close click')" id="close-modal"></button>
                    </div>
                    <form autocomplete="off" (ngSubmit)="saveMapping()" [formGroup]="mappingForm">
                        <div class="modal-body">          
                          
                                <div class="col">
                                    <label for="designation-field" class="form-label">Account Type</label>
                                    <select class="form-select mb-3" formControlName="accountType" aria-label="Default select">
                                        <option selected>Select</option>
                                        <option *ngFor="let account of accountTypes" value="{{ account.accountCode }}"> {{ account.name }}</option>
                                    </select>
                                </div>
                                <div class="col">
                                    <label for="designation-field" class="form-label">Income Range</label>
                                    <select class="form-select mb-3" formControlName="income"  aria-label="Default select example">
                                        <option selected>Select </option>
                                        <option *ngFor="let account of incomeRange" value="{{ account.incomeRangeCode}}">{{ account.incomeRangeName }}</option>
                                      
                                    </select>
                                </div>
                                <div class="col">
                                    <label for="designation-field" class="form-label">Product Bundle</label>
                                    <select class="form-select mb-3" formControlName="bundle"  aria-label="Default select example">
                                        <option selected>Select </option>
                                        <option *ngFor="let account of bundleCode" value="{{ account.code }}">{{ account.name }}</option>
                                      
                                    </select>
                                </div>
                                </div>
                             
                       
                                <div class="mt-4">
                                    <div class="hstack d-flex gap-2 justify-content-between mx-4 mb-4">
                                        <div>
                                            <!-- "Close" button -->
                                            <button type="button" class="btn btn-light btn-lg w-100" data-bs-dismiss="modal" (click)="modal.dismiss('close click')">Close</button>
                                        </div>
                                        <div>
                                            <!-- "Add" button -->
                                            <button [disabled]="loading" type="submit" class="btn btn-primary btn-lg px-4 w-100" id="add-btn">Save Mapping<span class="spinner-border spinner-border-sm ml-2" role="status" aria-hidden="true" *ngIf="loading"></span></button>
                                        </div>
                                    </div>

                                </div>
                    </form>
                </ng-template>

                <!-- Modal -->

                <ng-template #deletemodal role="document" let-modal>
                    <div class="modal-body p-5 text-center">
                        <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json" trigger="loop"
                            colors="primary:#405189,secondary:#f06548" style="width:90px;height:90px">
                        </lord-icon>
                        <div class="mt-4 text-center">
                            <h4>You are about to delete a bundle product ?</h4>
                            <p class="text-muted fs-15 mb-4">Deleting will remove this product from the product list.</p>
                            <div class="hstack gap-2 justify-content-center remove">
                                <button class="btn btn-light link-success fw-medium text-decoration-none"
                                    id="deleteRecord-close" data-bs-dismiss="modal"
                                    (click)="modal.dismiss('close click')"><i
                                        class="ri-close-line me-1 align-middle cursor-pointer"></i> Close</button>
                                <button class="btn btn-danger cursor-pointer" id="delete-record" (click)="deleteData(deleteId)">Yes,
                                    Delete
                                    It</button>
                            </div>
                        </div>
                    </div>
                </ng-template>
                <!--end modal -->
            </div>
        </div>

    </div>
    <!--end col-->
</div>